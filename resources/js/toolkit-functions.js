// Essential JavaScript functions for the toolkit\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  console.log(\"DOM fully loaded - initializing toolkit functions\");\n  \n  // Theme toggle functionality\n  const themeToggle = document.querySelector(\".theme-toggle\")\n  if (themeToggle) {\n    themeToggle.addEventListener(\"click\", () => {\n      const currentTheme = document.documentElement.getAttribute(\"data-theme\")\n      const newTheme = currentTheme === \"dark\" ? \"light\" : \"dark\"\n      \n      document.documentElement.setAttribute(\"data-theme\", newTheme)\n      localStorage.setItem(\"theme\", newTheme)\n      \n      // Update the icon\n      updateThemeIcon(newTheme)\n    })\n    \n    // Check for saved theme preference\n    const savedTheme = localStorage.getItem(\"theme\")\n    if (savedTheme) {\n      document.documentElement.setAttribute(\"data-theme\", savedTheme)\n      updateThemeIcon(savedTheme)\n    }\n  }\n\n  // Tab functionality\n  const tabBtns = document.querySelectorAll(\".tab-btn\")\n  tabBtns.forEach((btn) => {\n    btn.addEventListener(\"click\", function () {\n      const tabId = this.getAttribute(\"data-tab\")\n      const parentCard = this.closest(\".prompt-card\")\n\n      // Remove active class from all tabs in this card\n      parentCard.querySelectorAll(\".tab-btn\").forEach((tb) => tb.classList.remove(\"active\"))\n      parentCard.querySelectorAll(\".tab-content\").forEach((tc) => tc.classList.remove(\"active\"))\n\n      // Add active class to clicked tab and corresponding content\n      this.classList.add(\"active\")\n      parentCard.querySelector(`#${tabId}`).classList.add(\"active\")\n    })\n  })\n\n  // Category selection\n  const categoryButtons = document.querySelectorAll(\".category-button\")\n  const promptCategories = document.querySelectorAll(\".prompt-category\")\n\n  categoryButtons.forEach((button) => {\n    button.addEventListener(\"click\", function () {\n      const category = this.getAttribute(\"data-category\")\n\n      // Remove active class from all buttons\n      categoryButtons.forEach((btn) => btn.classList.remove(\"active\"))\n\n      // Add active class to clicked button\n      this.classList.add(\"active\")\n\n      // Show/hide categories based on selection\n      if (category === \"all\") {\n        promptCategories.forEach((cat) => (cat.style.display = \"block\"))\n      } else {\n        promptCategories.forEach((cat) => {\n          if (cat.getAttribute(\"data-category\") === category) {\n            cat.style.display = \"block\"\n          } else {\n            cat.style.display = \"none\"\n          }\n        })\n      }\n    })\n  })\n\n  // Search functionality\n  const searchInput = document.getElementById(\"search-input\")\n  const searchButton = document.getElementById(\"search-button\")\n\n  function performSearch() {\n    const searchTerm = searchInput.value.toLowerCase().trim()\n\n    if (searchTerm === \"\") {\n      // If search is empty, restore default view\n      promptCategories.forEach((cat) => (cat.style.display = \"block\"))\n      document.querySelectorAll(\".prompt-card\").forEach((card) => (card.style.display = \"block\"))\n      return\n    }\n\n    // Show all categories for searching\n    promptCategories.forEach((cat) => (cat.style.display = \"block\"))\n\n    // Search in cards\n    document.querySelectorAll(\".prompt-card\").forEach((card) => {\n      const title = card.querySelector(\".prompt-title\").textContent.toLowerCase()\n      const description = card.querySelector(\".prompt-description\").textContent.toLowerCase()\n      const content = card.textContent.toLowerCase()\n\n      if (title.includes(searchTerm) || description.includes(searchTerm) || content.includes(searchTerm)) {\n        card.style.display = \"block\"\n        // Make sure the parent category is visible\n        const parentCategory = card.closest(\".prompt-category\")\n        parentCategory.style.display = \"block\"\n      } else {\n        card.style.display = \"none\"\n      }\n    })\n\n    // Hide empty categories\n    promptCategories.forEach((category) => {\n      const visibleCards = category.querySelectorAll('.prompt-card[style=\"display: block;\"]')\n      if (visibleCards.length === 0) {\n        category.style.display = \"none\"\n      }\n    })\n  }\n\n  if (searchButton) {\n    searchButton.addEventListener(\"click\", performSearch)\n  }\n\n  if (searchInput) {\n    searchInput.addEventListener(\"keyup\", (e) => {\n      if (e.key === \"Enter\") {\n        performSearch()\n      }\n    })\n  }\n  \n  // Set up all copy buttons with direct click listeners\n  try {\n    const copyButtons = document.querySelectorAll('.copy-btn');\n    console.log(`Found ${copyButtons.length} copy buttons`);\n    \n    copyButtons.forEach(button => {\n      const onclickAttr = button.getAttribute('onclick');\n      console.log(`Setting up button with onclick: ${onclickAttr}`);\n      \n      if (onclickAttr) {\n        // Remove the onclick attribute to prevent automatic execution\n        button.removeAttribute('onclick');\n        \n        // Add direct click event listener\n        button.addEventListener('click', function() {\n          console.log('Copy button clicked');\n          \n          // Extract the ID from the original onclick attribute\n          if (onclickAttr.includes('copyPrompt(')) {\n            const match = onclickAttr.match(/copyPrompt\\(['\"]([^'\"]+)['\"]\\)/);\n            if (match && match[1]) {\n              const id = match[1];\n              fallbackCopyTextToClipboard(id, false, this);\n            }\n          } else if (onclickAttr.includes('copyGeneratedPrompt(')) {\n            const match = onclickAttr.match(/copyGeneratedPrompt\\(['\"]([^'\"]+)['\"]\\)/);\n            if (match && match[1]) {\n              const id = match[1];\n              fallbackCopyTextToClipboard(id, true, this);\n            }\n          }\n        });\n      }\n    });\n  } catch (err) {\n    console.error('Error setting up copy buttons:', err);\n  }\n  \n  console.log(\"All toolkit functions initialized\");\n})\n\n// Function to update theme icon\nfunction updateThemeIcon(theme) {\n  const themeToggle = document.querySelector(\".theme-toggle\")\n  if (!themeToggle) return\n\n  if (theme === \"dark\") {\n    themeToggle.innerHTML = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"theme-icon-light\">\n        <path d=\"M12 9c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.03 0 1.42l1.42 1.42c.39.39 1.03.39 1.42 0 .39-.39.39-1.03 0-1.42L5.99 4.58zm12.42 12.42c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.03 0 1.42l1.42 1.42c.39.39 1.03.39 1.42 0 .39-.39.39-1.03 0-1.42l-1.42-1.42zM18.01 4.58l-1.42 1.42c-.39.39-.39 1.03 0 1.42.39.39 1.03.39 1.42 0l1.42-1.42c.39-.39.39-1.03 0-1.42-.39-.39-1.03-.39-1.42 0zM5.59 16.99l-1.42 1.42c-.39.39-.39 1.03 0 1.42.39.39 1.03.39 1.42 0l1.42-1.42c.39-.39.39-1.03 0-1.42-.39-.39-1.03-.39-1.42 0z\"/>\n      </svg>\n    `\n  } else {\n    themeToggle.innerHTML = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"theme-icon-dark\">\n        <path d=\"M10 2c-1.82 0-3.53.5-5 1.35C2.99 4.82 2 7.34 2 10c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 0 12 0L10 2zm0 18c-4.41 0-8-3.59-8-8 0-3.36 2.08-6.23 5-7.41C5.62 5.73 5 7.79 5 10c0 4.41 3.59 8 8 8s8-3.59 8-8c0-2.21-.9-4.21-2.35-5.65C17.79 17.85 14.23 20 10 20z\" fill=\"currentColor\"/>\n      </svg>\n    `\n  }\n}\n\n// Absolutely basic copy text to clipboard function\nfunction fallbackCopyTextToClipboard(id, isGenerated, button) {\n  console.log(`Attempting to copy text for ID: ${id}, isGenerated: ${isGenerated}`);\n  \n  try {\n    // Find the element with the text to copy\n    let element;\n    if (isGenerated) {\n      element = document.getElementById(`${id}-output`);\n      if (element && element.textContent.trim() === '') {\n        // If empty, try to generate it first\n        generatePrompt(id);\n      }\n    } else {\n      element = document.getElementById(id);\n    }\n    \n    if (!element) {\n      console.error(`Element not found: ${isGenerated ? id + '-output' : id}`);\n      showNotification('Error finding text to copy. Please try again.', 'error');\n      return;\n    }\n    \n    // Get the text content\n    const text = element.innerText.trim();\n    console.log(`Found text to copy (${text.length} characters)`);\n    \n    // Create a temporary input element\n    const tempInput = document.createElement('textarea');\n    tempInput.value = text;\n    document.body.appendChild(tempInput);\n    \n    // Position offscreen\n    tempInput.style.position = 'absolute';\n    tempInput.style.left = '-9999px';\n    \n    // Select the text and copy it\n    tempInput.select();\n    tempInput.setSelectionRange(0, 99999); // For mobile devices\n    \n    // Try to copy in multiple ways\n    let copySuccess = false;\n    \n    // Method 1: document.execCommand\n    try {\n      const successful = document.execCommand('copy');\n      if (successful) {\n        console.log('Copy successful using execCommand');\n        copySuccess = true;\n      }\n    } catch (err) {\n      console.log('execCommand failed:', err);\n    }\n    \n    // Method 2: Try navigator.clipboard as a backup\n    if (!copySuccess && navigator.clipboard) {\n      try {\n        navigator.clipboard.writeText(text);\n        console.log('Copy successful using navigator.clipboard');\n        copySuccess = true;\n      } catch (err) {\n        console.log('navigator.clipboard failed:', err);\n      }\n    }\n    \n    // Method 3: If still not working, prompt user to copy manually\n    if (!copySuccess) {\n      console.log('Showing manual copy prompt');\n      // Focus and select the text again to make it easy for the user\n      tempInput.focus();\n      tempInput.select();\n      \n      // Show a prompt instructing the user to manually copy\n      alert('Please press Ctrl+C or Cmd+C to copy the text manually');\n    }\n    \n    // Remove the temporary element\n    document.body.removeChild(tempInput);\n    \n    // Update button visual state\n    const originalHTML = button.innerHTML;\n    button.innerHTML = `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z\"></path>\n      </svg>\n      Copied!\n    `;\n    button.classList.add('copied');\n    \n    // Reset the button after delay\n    setTimeout(() => {\n      button.innerHTML = originalHTML;\n      button.classList.remove('copied');\n    }, 2000);\n    \n    // Show notification\n    showNotification(copySuccess ? \n      (isGenerated ? 'Complete prompt copied to clipboard!' : 'Prompt copied to clipboard!') : \n      'Manual copy required - please use Ctrl+C/Cmd+C');\n    \n  } catch (err) {\n    console.error('Copy operation failed:', err);\n    showNotification('Copy failed. Please try again or copy manually.', 'error');\n  }\n}\n\n// Function to move to next tab\nfunction nextTab(baseId) {\n  const structureTab = document.querySelector(`[data-tab=\"structure-${baseId}\"]`)\n  const contentTab = document.querySelector(`[data-tab=\"content-${baseId}\"]`)\n\n  if (!structureTab || !contentTab) {\n    console.error(`Tabs for ${baseId} not found`)\n    return\n  }\n\n  // Update tab buttons\n  structureTab.classList.remove(\"active\")\n  contentTab.classList.add(\"active\")\n\n  // Mark the first tab as completed\n  structureTab.classList.add(\"completed\")\n\n  // Update tab content\n  const structureContent = document.getElementById(`structure-${baseId}`)\n  const contentContent = document.getElementById(`content-${baseId}`)\n\n  if (!structureContent || !contentContent) {\n    console.error(`Tab content for ${baseId} not found`)\n    return\n  }\n\n  structureContent.classList.remove(\"active\")\n  contentContent.classList.add(\"active\")\n\n  // Scroll to the content tab if needed\n  contentContent.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" })\n}\n\n// Function to generate the complete prompt\nfunction generatePrompt(baseId) {\n  console.log(`Generating prompt for ${baseId}`);\n  \n  // Get all input values\n  const inputElements = document.querySelectorAll(`[id^=\"${baseId}-\"]`)\n  if (inputElements.length === 0) {\n    console.error(`No input elements found for base ID: ${baseId}`)\n    showNotification(\"Error generating prompt. Please try again.\", \"error\")\n    return\n  }\n\n  const inputData = {}\n\n  inputElements.forEach((input) => {\n    if (input.id === `${baseId}-structure` || input.id === `${baseId}-output`) return\n    const key = input.id.replace(`${baseId}-`, \"\")\n    inputData[key] = input.value.trim()\n  })\n\n  // Get structure prompt\n  const structurePromptElement = document.getElementById(`${baseId}-structure`)\n  if (!structurePromptElement) {\n    console.error(`Structure prompt element not found for base ID: ${baseId}`)\n    showNotification(\"Error generating prompt. Please try again.\", \"error\")\n    return\n  }\n\n  const structurePrompt = structurePromptElement.textContent\n\n  // Generate the complete prompt based on the template and user inputs\n  let outputPrompt =\n    structurePrompt +\n    \"\\n\\nPHASE 2: CONTENT DEVELOPMENT\\nNow, use the following specific details to populate the above framework:\"\n\n  // Add each input field with a label\n  for (const [key, value] of Object.entries(inputData)) {\n    if (value) {\n      // Format key from camelCase or kebab-case to Title Case\n      const formattedKey = key\n        .replace(/-/g, \" \")\n        .replace(/([A-Z])/g, \" $1\")\n        .split(\" \")\n        .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n        .join(\" \")\n\n      outputPrompt += `\\n\\n${formattedKey}: ${value}`\n    }\n  }\n\n  // Add final instructions\n  outputPrompt +=\n    \"\\n\\nPlease generate a detailed document following the structure provided in Phase 1, incorporating these specific details. Ensure the document is comprehensive, well-organized, and actionable.\"\n\n  // Display the complete prompt\n  const outputElement = document.getElementById(`${baseId}-output`)\n  if (!outputElement) {\n    console.error(`Output element not found for base ID: ${baseId}`)\n    showNotification(\"Error generating prompt. Please try again.\", \"error\")\n    return\n  }\n\n  outputElement.textContent = outputPrompt\n  console.log(`Generated prompt content (${outputPrompt.length} characters)`);\n\n  // Update copy button text\n  const copyBtn = document.getElementById(`${baseId}-copy-btn`)\n  if (copyBtn) {\n    copyBtn.innerHTML = `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\n        <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\n      </svg>\n      Copy Complete Prompt\n    `\n  }\n\n  showNotification(\"Complete prompt generated!\")\n  \n  // Scroll to the output\n  outputElement.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" })\n}\n\n// Function to show notification\nfunction showNotification(message, type = \"success\") {\n  console.log(`Showing notification: ${message} (${type})`);\n  \n  // Remove any existing notifications\n  const existingNotification = document.querySelector(\".notification\")\n  if (existingNotification) {\n    existingNotification.remove()\n  }\n\n  // Create notification element\n  const notification = document.createElement(\"div\")\n  notification.className = `notification ${type}`\n\n  // Set icon based on type\n  let icon = `\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n      <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n      <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\n    </svg>\n  `\n\n  if (type === \"error\") {\n    icon = `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n        <line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"></line>\n        <line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"></line>\n      </svg>\n    `\n  }\n\n  notification.innerHTML = `${icon} ${message}`\n\n  // Add to document\n  document.body.appendChild(notification)\n\n  // Show notification\n  setTimeout(() => {\n    notification.classList.add(\"show\")\n  }, 10)\n\n  // Hide after 3 seconds\n  setTimeout(() => {\n    notification.classList.remove(\"show\")\n    setTimeout(() => {\n      notification.remove()\n    }, 300)\n  }, 3000)\n}\n\n// Function to save form data\nfunction saveFormData() {\n  const forms = document.querySelectorAll(\".input-form\")\n\n  forms.forEach((form) => {\n    const inputs = form.querySelectorAll(\"input, textarea\")\n    const formId = form.closest(\".tab-content\").id\n    const formData = {}\n\n    inputs.forEach((input) => {\n      formData[input.id] = input.value\n    })\n\n    localStorage.setItem(`formData-${formId}`, JSON.stringify(formData))\n  })\n}\n\n// Function to load form data\nfunction loadFormData() {\n  const forms = document.querySelectorAll(\".input-form\")\n\n  forms.forEach((form) => {\n    const formId = form.closest(\".tab-content\").id\n    const savedData = localStorage.getItem(`formData-${formId}`)\n\n    if (savedData) {\n      const formData = JSON.parse(savedData)\n\n      for (const [id, value] of Object.entries(formData)) {\n        const input = document.getElementById(id)\n        if (input) input.value = value\n      }\n    }\n  })\n}\n\n// Load saved form data on page load\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  loadFormData()\n  \n  // Save form data when inputs change\n  document.querySelectorAll(\".input-form input, .input-form textarea\").forEach(input => {\n    input.addEventListener(\"change\", saveFormData)\n  })\n})\n\n// Preserve original functions for compatibility\nfunction copyPrompt(id) {\n  console.log(`Original copyPrompt function called with id: ${id}`);\n  // Find the button and trigger click event\n  const buttons = document.querySelectorAll('.copy-btn');\n  let found = false;\n  \n  buttons.forEach(button => {\n    const onclickAttr = button.getAttribute('data-original-onclick') || button.getAttribute('onclick');\n    if (onclickAttr && onclickAttr.includes(`copyPrompt('${id}')`)) {\n      button.click();\n      found = true;\n    }\n  });\n  \n  if (!found) {\n    // Direct fallback if button not found\n    fallbackCopyTextToClipboard(id, false, { \n      innerHTML: '', \n      classList: { add: () => {}, remove: () => {} }\n    });\n  }\n}\n\nfunction copyGeneratedPrompt(baseId) {\n  console.log(`Original copyGeneratedPrompt function called with baseId: ${baseId}`);\n  // Find the button and trigger click event\n  const button = document.getElementById(`${baseId}-copy-btn`);\n  \n  if (button) {\n    button.click();\n  } else {\n    // Direct fallback if button not found\n    fallbackCopyTextToClipboard(baseId, true, { \n      innerHTML: '', \n      classList: { add: () => {}, remove: () => {} }\n    });\n  }\n}\n\n// Add this at the end of the file\nconsole.log(\"Toolkit JavaScript loaded successfully!\");\n