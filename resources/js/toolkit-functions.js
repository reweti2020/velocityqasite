// Essential JavaScript functions for the toolkit\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  console.log(\"DOM fully loaded - initializing toolkit functions\");\n  \n  // Theme toggle functionality\n  const themeToggle = document.querySelector(\".theme-toggle\")\n  if (themeToggle) {\n    themeToggle.addEventListener(\"click\", () => {\n      const currentTheme = document.documentElement.getAttribute(\"data-theme\")\n      const newTheme = currentTheme === \"dark\" ? \"light\" : \"dark\"\n      \n      document.documentElement.setAttribute(\"data-theme\", newTheme)\n      localStorage.setItem(\"theme\", newTheme)\n      \n      // Update the icon\n      updateThemeIcon(newTheme)\n    })\n    \n    // Check for saved theme preference\n    const savedTheme = localStorage.getItem(\"theme\")\n    if (savedTheme) {\n      document.documentElement.setAttribute(\"data-theme\", savedTheme)\n      updateThemeIcon(savedTheme)\n    }\n  }\n\n  // Tab functionality\n  const tabBtns = document.querySelectorAll(\".tab-btn\")\n  tabBtns.forEach((btn) => {\n    btn.addEventListener(\"click\", function () {\n      const tabId = this.getAttribute(\"data-tab\")\n      const parentCard = this.closest(\".prompt-card\")\n\n      // Remove active class from all tabs in this card\n      parentCard.querySelectorAll(\".tab-btn\").forEach((tb) => tb.classList.remove(\"active\"))\n      parentCard.querySelectorAll(\".tab-content\").forEach((tc) => tc.classList.remove(\"active\"))\n\n      // Add active class to clicked tab and corresponding content\n      this.classList.add(\"active\")\n      parentCard.querySelector(`#${tabId}`).classList.add(\"active\")\n    })\n  })\n\n  // Category selection\n  const categoryButtons = document.querySelectorAll(\".category-button\")\n  const promptCategories = document.querySelectorAll(\".prompt-category\")\n\n  categoryButtons.forEach((button) => {\n    button.addEventListener(\"click\", function () {\n      const category = this.getAttribute(\"data-category\")\n\n      // Remove active class from all buttons\n      categoryButtons.forEach((btn) => btn.classList.remove(\"active\"))\n\n      // Add active class to clicked button\n      this.classList.add(\"active\")\n\n      // Show/hide categories based on selection\n      if (category === \"all\") {\n        promptCategories.forEach((cat) => (cat.style.display = \"block\"))\n      } else {\n        promptCategories.forEach((cat) => {\n          if (cat.getAttribute(\"data-category\") === category) {\n            cat.style.display = \"block\"\n          } else {\n            cat.style.display = \"none\"\n          }\n        })\n      }\n    })\n  })\n\n  // Search functionality\n  const searchInput = document.getElementById(\"search-input\")\n  const searchButton = document.getElementById(\"search-button\")\n\n  function performSearch() {\n    const searchTerm = searchInput.value.toLowerCase().trim()\n\n    if (searchTerm === \"\") {\n      // If search is empty, restore default view\n      promptCategories.forEach((cat) => (cat.style.display = \"block\"))\n      document.querySelectorAll(\".prompt-card\").forEach((card) => (card.style.display = \"block\"))\n      return\n    }\n\n    // Show all categories for searching\n    promptCategories.forEach((cat) => (cat.style.display = \"block\"))\n\n    // Search in cards\n    document.querySelectorAll(\".prompt-card\").forEach((card) => {\n      const title = card.querySelector(\".prompt-title\").textContent.toLowerCase()\n      const description = card.querySelector(\".prompt-description\").textContent.toLowerCase()\n      const content = card.textContent.toLowerCase()\n\n      if (title.includes(searchTerm) || description.includes(searchTerm) || content.includes(searchTerm)) {\n        card.style.display = \"block\"\n        // Make sure the parent category is visible\n        const parentCategory = card.closest(\".prompt-category\")\n        parentCategory.style.display = \"block\"\n      } else {\n        card.style.display = \"none\"\n      }\n    })\n\n    // Hide empty categories\n    promptCategories.forEach((category) => {\n      const visibleCards = category.querySelectorAll('.prompt-card[style=\"display: block;\"]')\n      if (visibleCards.length === 0) {\n        category.style.display = \"none\"\n      }\n    })\n  }\n\n  if (searchButton) {\n    searchButton.addEventListener(\"click\", performSearch)\n  }\n\n  if (searchInput) {\n    searchInput.addEventListener(\"keyup\", (e) => {\n      if (e.key === \"Enter\") {\n        performSearch()\n      }\n    })\n  }\n  \n  // Setup direct copy button functionality\n  setupDirectCopyFunctionality();\n  \n  console.log(\"All toolkit functions initialized\");\n})\n\n// Function to update theme icon\nfunction updateThemeIcon(theme) {\n  const themeToggle = document.querySelector(\".theme-toggle\")\n  if (!themeToggle) return\n\n  if (theme === \"dark\") {\n    themeToggle.innerHTML = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"theme-icon-light\">\n        <path d=\"M12 9c1.65 0 3 1.35 3 3s-1.35 3-3 3-3-1.35-3-3 1.35-3 3-3M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.03 0 1.42l1.42 1.42c.39.39 1.03.39 1.42 0 .39-.39.39-1.03 0-1.42L5.99 4.58zm12.42 12.42c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.03 0 1.42l1.42 1.42c.39.39 1.03.39 1.42 0 .39-.39.39-1.03 0-1.42l-1.42-1.42zM18.01 4.58l-1.42 1.42c-.39.39-.39 1.03 0 1.42.39.39 1.03.39 1.42 0l1.42-1.42c.39-.39.39-1.03 0-1.42-.39-.39-1.03-.39-1.42 0zM5.59 16.99l-1.42 1.42c-.39.39-.39 1.03 0 1.42.39.39 1.03.39 1.42 0l1.42-1.42c.39-.39.39-1.03 0-1.42-.39-.39-1.03-.39-1.42 0z\"/>\n      </svg>\n    `\n  } else {\n    themeToggle.innerHTML = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" class=\"theme-icon-dark\">\n        <path d=\"M10 2c-1.82 0-3.53.5-5 1.35C2.99 4.82 2 7.34 2 10c0 5.52 4.48 10 10 10s10-4.48 10-10S17.52 0 12 0L10 2zm0 18c-4.41 0-8-3.59-8-8 0-3.36 2.08-6.23 5-7.41C5.62 5.73 5 7.79 5 10c0 4.41 3.59 8 8 8s8-3.59 8-8c0-2.21-.9-4.21-2.35-5.65C17.79 17.85 14.23 20 10 20z\" fill=\"currentColor\"/>\n      </svg>\n    `\n  }\n}\n\n// Setup direct copy functionality \nfunction setupDirectCopyFunctionality() {\n  // Find all copy buttons\n  const copyButtons = document.querySelectorAll('.copy-btn');\n  console.log(`Found ${copyButtons.length} copy buttons`, copyButtons);\n  \n  copyButtons.forEach(button => {\n    // Remove the onclick attribute and add a direct event listener\n    const onclickAttr = button.getAttribute('onclick');\n    console.log(`Processing button with onclick: ${onclickAttr}`);\n    \n    if (onclickAttr) {\n      // Store the original onclick in a data attribute\n      button.setAttribute('data-original-onclick', onclickAttr);\n      button.removeAttribute('onclick');\n      \n      // Add direct click handler\n      button.addEventListener('click', handleCopyClick);\n    }\n  });\n}\n\n// Handle copy button clicks\nfunction handleCopyClick(event) {\n  console.log('Copy button clicked', event.currentTarget);\n  const button = event.currentTarget;\n  const onclickAttr = button.getAttribute('data-original-onclick');\n  \n  // Extract the function name and ID from onclick attribute\n  let idMatch;\n  if (onclickAttr && (idMatch = onclickAttr.match(/copy\\w+\\(\\s*['\"](\\w+)['\"]\\s*\\)/))) {\n    const id = idMatch[1];\n    console.log(`Extracted ID: ${id} from onclick: ${onclickAttr}`);\n    \n    // Handle different types of copy operations\n    if (onclickAttr.includes('copyPrompt')) {\n      copyToClipboardDirect(id, false, button);\n    } else if (onclickAttr.includes('copyGeneratedPrompt')) {\n      copyToClipboardDirect(id, true, button);\n    }\n  } else if (button.id && button.id.endsWith('-copy-btn')) {\n    // Handle by button ID pattern\n    const baseId = button.id.replace('-copy-btn', '');\n    console.log(`Using ID pattern, baseId: ${baseId}`);\n    copyToClipboardDirect(baseId, true, button);\n  } else {\n    console.error('Could not determine what to copy', button);\n  }\n}\n\n// The most basic, reliable clipboard copy function\nfunction copyToClipboardDirect(id, isGenerated, button) {\n  console.log(`Attempting to copy ${isGenerated ? 'generated' : 'standard'} content with ID: ${id}`);\n  \n  // Find the element containing the text to copy\n  let element;\n  if (isGenerated) {\n    element = document.getElementById(`${id}-output`);\n    // If output is empty, generate it first\n    if (element && element.textContent.trim() === '') {\n      console.log('Empty output, generating content first');\n      generatePrompt(id);\n    }\n  } else {\n    element = document.getElementById(id);\n  }\n  \n  if (!element) {\n    console.error(`Element not found: ${isGenerated ? id + '-output' : id}`);\n    return false;\n  }\n  \n  // Get the text content\n  const text = element.innerText.trim();\n  console.log(`Found text to copy (${text.length} characters):`, text.substring(0, 50) + '...');\n  \n  try {\n    // Create a temporary textarea element\n    const textarea = document.createElement('textarea');\n    textarea.value = text;\n    \n    // Position the textarea offscreen\n    textarea.style.position = 'fixed';\n    textarea.style.left = '-9999px';\n    textarea.style.top = '0';\n    document.body.appendChild(textarea);\n    \n    // Select the content\n    textarea.focus();\n    textarea.select();\n    \n    // Execute the copy command\n    const successful = document.execCommand('copy');\n    document.body.removeChild(textarea);\n    \n    console.log(`Copy ${successful ? 'successful' : 'failed'}`);\n    \n    if (successful) {\n      // Update the button to show success feedback\n      const originalHTML = button.innerHTML;\n      button.innerHTML = `\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z\"></path>\n        </svg>\n        Copied!\n      `;\n      button.classList.add('copied');\n      \n      // Reset after a delay\n      setTimeout(() => {\n        button.innerHTML = originalHTML;\n        button.classList.remove('copied');\n      }, 2000);\n      \n      // Show success notification\n      showNotification(isGenerated ? 'Complete prompt copied to clipboard!' : 'Prompt copied to clipboard!');\n      return true;\n    } else {\n      showNotification('Failed to copy. Please try again.', 'error');\n      return false;\n    }\n  } catch (err) {\n    console.error('Error during copy operation:', err);\n    showNotification('Failed to copy. Please try again.', 'error');\n    return false;\n  }\n}\n\n// Function to move to next tab\nfunction nextTab(baseId) {\n  const structureTab = document.querySelector(`[data-tab=\"structure-${baseId}\"]`)\n  const contentTab = document.querySelector(`[data-tab=\"content-${baseId}\"]`)\n\n  if (!structureTab || !contentTab) {\n    console.error(`Tabs for ${baseId} not found`)\n    return\n  }\n\n  // Update tab buttons\n  structureTab.classList.remove(\"active\")\n  contentTab.classList.add(\"active\")\n\n  // Mark the first tab as completed\n  structureTab.classList.add(\"completed\")\n\n  // Update tab content\n  const structureContent = document.getElementById(`structure-${baseId}`)\n  const contentContent = document.getElementById(`content-${baseId}`)\n\n  if (!structureContent || !contentContent) {\n    console.error(`Tab content for ${baseId} not found`)\n    return\n  }\n\n  structureContent.classList.remove(\"active\")\n  contentContent.classList.add(\"active\")\n\n  // Scroll to the content tab if needed\n  contentContent.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" })\n}\n\n// Function to generate the complete prompt\nfunction generatePrompt(baseId) {\n  console.log(`Generating prompt for ${baseId}`);\n  \n  // Get all input values\n  const inputElements = document.querySelectorAll(`[id^=\"${baseId}-\"]`)\n  if (inputElements.length === 0) {\n    console.error(`No input elements found for base ID: ${baseId}`)\n    showNotification(\"Error generating prompt. Please try again.\", \"error\")\n    return\n  }\n\n  const inputData = {}\n\n  inputElements.forEach((input) => {\n    if (input.id === `${baseId}-structure` || input.id === `${baseId}-output`) return\n    const key = input.id.replace(`${baseId}-`, \"\")\n    inputData[key] = input.value.trim()\n  })\n\n  // Get structure prompt\n  const structurePromptElement = document.getElementById(`${baseId}-structure`)\n  if (!structurePromptElement) {\n    console.error(`Structure prompt element not found for base ID: ${baseId}`)\n    showNotification(\"Error generating prompt. Please try again.\", \"error\")\n    return\n  }\n\n  const structurePrompt = structurePromptElement.textContent\n\n  // Generate the complete prompt based on the template and user inputs\n  let outputPrompt =\n    structurePrompt +\n    \"\\n\\nPHASE 2: CONTENT DEVELOPMENT\\nNow, use the following specific details to populate the above framework:\"\n\n  // Add each input field with a label\n  for (const [key, value] of Object.entries(inputData)) {\n    if (value) {\n      // Format key from camelCase or kebab-case to Title Case\n      const formattedKey = key\n        .replace(/-/g, \" \")\n        .replace(/([A-Z])/g, \" $1\")\n        .split(\" \")\n        .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n        .join(\" \")\n\n      outputPrompt += `\\n\\n${formattedKey}: ${value}`\n    }\n  }\n\n  // Add final instructions\n  outputPrompt +=\n    \"\\n\\nPlease generate a detailed document following the structure provided in Phase 1, incorporating these specific details. Ensure the document is comprehensive, well-organized, and actionable.\"\n\n  // Display the complete prompt\n  const outputElement = document.getElementById(`${baseId}-output`)\n  if (!outputElement) {\n    console.error(`Output element not found for base ID: ${baseId}`)\n    showNotification(\"Error generating prompt. Please try again.\", \"error\")\n    return\n  }\n\n  outputElement.textContent = outputPrompt\n  console.log(`Generated prompt content (${outputPrompt.length} characters)`);\n\n  // Update copy button text\n  const copyBtn = document.getElementById(`${baseId}-copy-btn`)\n  if (copyBtn) {\n    copyBtn.innerHTML = `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"></rect>\n        <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"></path>\n      </svg>\n      Copy Complete Prompt\n    `\n  }\n\n  showNotification(\"Complete prompt generated!\")\n  \n  // Scroll to the output\n  outputElement.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" })\n}\n\n// Function to show notification\nfunction showNotification(message, type = \"success\") {\n  console.log(`Showing notification: ${message} (${type})`);\n  \n  // Remove any existing notifications\n  const existingNotification = document.querySelector(\".notification\")\n  if (existingNotification) {\n    existingNotification.remove()\n  }\n\n  // Create notification element\n  const notification = document.createElement(\"div\")\n  notification.className = `notification ${type}`\n\n  // Set icon based on type\n  let icon = `\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n      <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n      <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\n    </svg>\n  `\n\n  if (type === \"error\") {\n    icon = `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n        <line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"></line>\n        <line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"></line>\n      </svg>\n    `\n  }\n\n  notification.innerHTML = `${icon} ${message}`\n\n  // Add to document\n  document.body.appendChild(notification)\n\n  // Show notification\n  setTimeout(() => {\n    notification.classList.add(\"show\")\n  }, 10)\n\n  // Hide after 3 seconds\n  setTimeout(() => {\n    notification.classList.remove(\"show\")\n    setTimeout(() => {\n      notification.remove()\n    }, 300)\n  }, 3000)\n}\n\n// Function to save form data\nfunction saveFormData() {\n  const forms = document.querySelectorAll(\".input-form\")\n\n  forms.forEach((form) => {\n    const inputs = form.querySelectorAll(\"input, textarea\")\n    const formId = form.closest(\".tab-content\").id\n    const formData = {}\n\n    inputs.forEach((input) => {\n      formData[input.id] = input.value\n    })\n\n    localStorage.setItem(`formData-${formId}`, JSON.stringify(formData))\n  })\n}\n\n// Function to load form data\nfunction loadFormData() {\n  const forms = document.querySelectorAll(\".input-form\")\n\n  forms.forEach((form) => {\n    const formId = form.closest(\".tab-content\").id\n    const savedData = localStorage.getItem(`formData-${formId}`)\n\n    if (savedData) {\n      const formData = JSON.parse(savedData)\n\n      for (const [id, value] of Object.entries(formData)) {\n        const input = document.getElementById(id)\n        if (input) input.value = value\n      }\n    }\n  })\n}\n\n// Load saved form data on page load\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  loadFormData()\n  \n  // Save form data when inputs change\n  document.querySelectorAll(\".input-form input, .input-form textarea\").forEach(input => {\n    input.addEventListener(\"change\", saveFormData)\n  })\n})\n\n// Original functions as compatibility wrappers\nfunction copyPrompt(id) {\n  console.log(`Original copyPrompt called with id: ${id}`);\n  const element = document.getElementById(id);\n  if (!element) {\n    console.error(`Element with ID ${id} not found`);\n    return;\n  }\n  \n  // Find the copy button for this element\n  const copyBtn = document.querySelector(`[data-original-onclick=\"copyPrompt('${id}')\"]`);\n  \n  copyToClipboardDirect(id, false, copyBtn || { innerHTML: '', classList: { add: () => {}, remove: () => {} } });\n}\n\nfunction copyGeneratedPrompt(baseId) {\n  console.log(`Original copyGeneratedPrompt called with baseId: ${baseId}`);\n  \n  // Find the copy button\n  const copyBtn = document.getElementById(`${baseId}-copy-btn`);\n  \n  copyToClipboardDirect(baseId, true, copyBtn || { innerHTML: '', classList: { add: () => {}, remove: () => {} } });\n}\n\n// Debug function that can be called manually from console\nfunction diagnoseCopyFunctionality() {\n  console.group('Copy Functionality Diagnosis');\n  \n  console.log('Copy buttons:');\n  document.querySelectorAll('.copy-btn').forEach((btn, i) => {\n    console.log(`Button ${i + 1}:`, {\n      element: btn,\n      id: btn.id,\n      onclick: btn.getAttribute('onclick'),\n      dataOriginalOnclick: btn.getAttribute('data-original-onclick'),\n      hasClickListener: btn.onclick !== null || btn._events?.click\n    });\n  });\n  \n  console.log('\\nTest text elements:');\n  ['healthcare-integration-structure', 'medical-qa-structure', 'financial-analysis-structure'].forEach(id => {\n    const el = document.getElementById(id);\n    if (el) {\n      console.log(`Element #${id}:`, {\n        exists: true,\n        textLength: el.textContent.length,\n        innerTextLength: el.innerText.length,\n        sample: el.innerText.substring(0, 50) + '...'\n      });\n    } else {\n      console.log(`Element #${id} does not exist`);\n    }\n  });\n  \n  console.groupEnd();\n  return 'Diagnosis complete - check console for details';\n}\n\nwindow.diagnoseCopyFunctionality = diagnoseCopyFunctionality;\n\n// Add this at the end of the file\nconsole.log(\"Toolkit JavaScript loaded successfully!\");\n